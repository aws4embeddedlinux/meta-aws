name: ff-merge
on:
  workflow_dispatch:
      inputs:
        branches:
          description: 'branches to ff merge branch-next into'
          default: '["master", "dunfell", "gatesgarth", "hardknott", "honister", "kirkstone", "zeus", "langdale", "mickledore", "nanbield", "scarthgap", "styhead", "walnascar"]'
          required: true
permissions:
  contents: read

jobs:
  ff-merge:
    runs-on: ubuntu-22.04
    strategy:
      matrix:
        branch:  ${{ fromJson(github.event.inputs.branches) }}
      fail-fast: false
    steps:
         - name: clone meta-aws branch
           uses: actions/checkout@v4
           with:
              ref: ${{ matrix.branch }}
              path: meta-aws
              fetch-depth: 0
              token: ${{ secrets.BOT_CREDENTIAL }}
         - name: merge branch-next into branch
           working-directory: meta-aws
           env:
             BRANCH_NAME: ${{ matrix.branch }}
           run: |
             git config --global user.name aws-iot-embedded-linux-ci
             git config --global user.email aws-iot-embedded-linux-ci@users.noreply.github.com
             git merge --ff-only "origin/${BRANCH_NAME}-next"
         - name: push branch
           working-directory: meta-aws
           env:
             BRANCH_NAME: ${{ matrix.branch }}
           run: |
             git push -u origin "${BRANCH_NAME}"
