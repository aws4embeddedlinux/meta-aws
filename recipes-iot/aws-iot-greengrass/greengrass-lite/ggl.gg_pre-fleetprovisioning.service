[Unit]
Description=Greengrass Lite pre Fleet Provisioning Service
After=systemd-time-wait-sync.service
After=network-online.target
Wants=network-online.target
Before=ggl.core.ggconfigd.service
Before=ggl.gg_fleetprovisioning.service
ConditionPathExists=!/var/lib/greengrass/credentials

[Service]
Type=oneshot
ExecStart=/bin/sh -c '\
<<<<<<< HEAD
    default_iface=$(busybox route | grep default | awk "{print \$8}"); \
    mac_address=$(busybox ifconfig "$default_iface" | grep -o -E "([[:xdigit:]]{1,2}:){5}[[:xdigit:]]{1,2}" | tr ":" "_"); \
=======
    default_iface=$(ip route | grep default | cut -d" " -f5 | head -n1); \
    mac_address=$(cat /sys/class/net/"$default_iface"/address | tr ":" "_"); \
>>>>>>> 5e34c7e8 (greengrass-lite: upgrade 2.2.0 -> 2.3.0)
    sed -i "s/<unique>/$mac_address/g" "/etc/greengrass/config.d/fleetprovisioning.yaml";'
Restart=on-failure
RestartSec=10s
StartLimitIntervalSec=300
StartLimitBurst=3
TimeoutSec=300
SuccessExitStatus=0 1
User=root
Group=root
RemainAfterExit=true

[Install]
WantedBy=greengrass-lite.target
