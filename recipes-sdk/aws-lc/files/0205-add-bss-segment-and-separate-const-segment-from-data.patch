From da92fdbaac330b5785eb3581b99e780e52ffa609 Mon Sep 17 00:00:00 2001
From: William Bo Yang <coolbillyang@gmail.com>
Date: Thu, 16 Mar 2023 16:41:16 -0700
Subject: [PATCH] add bss segment and separate const segment from data segment
 (#880)

---
 crypto/fipsmodule/bcm.c                        | 3 ++-
 crypto/fipsmodule/fips_shared_library_marker.c | 6 ++++--
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/crypto/fipsmodule/bcm.c b/crypto/fipsmodule/bcm.c
index f5352075f..f8710f0b4 100644
--- a/crypto/fipsmodule/bcm.c
+++ b/crypto/fipsmodule/bcm.c
@@ -30,7 +30,8 @@
 #if defined(BORINGSSL_FIPS) && defined(OPENSSL_WINDOWS)
 #pragma code_seg(".fipstx$b")
 #pragma data_seg(".fipsda$b")
-#pragma const_seg(".fipsda$b")
+#pragma const_seg(".fipsco$b")
+#pragma bss_seg(".fipsbs$b")
 #endif
 
 #include <openssl/digest.h>
diff --git a/crypto/fipsmodule/fips_shared_library_marker.c b/crypto/fipsmodule/fips_shared_library_marker.c
index fb37e6b87..504260d42 100644
--- a/crypto/fipsmodule/fips_shared_library_marker.c
+++ b/crypto/fipsmodule/fips_shared_library_marker.c
@@ -21,7 +21,8 @@
 #if defined(_MSC_VER)
 #pragma code_seg(".fipstx$a")
 #pragma data_seg(".fipsda$a")
-#pragma const_seg(".fipsda$a")
+#pragma const_seg(".fipsco$a")
+#pragma bss_seg(".fipsbs$a")
 #endif
 
 // Dummy but not empty function and array to avoid the compiler completely
@@ -36,7 +37,8 @@ const uint8_t BORINGSSL_bcm_rodata_start[16] =
 #if defined(_MSC_VER)
 #pragma code_seg(".fipstx$z")
 #pragma data_seg(".fipsda$z")
-#pragma const_seg(".fipsda$z")
+#pragma const_seg(".fipsco$z")
+#pragma bss_seg(".fipsbs$z")
 #endif
 
 // Dummy but not empty function and array to avoid the compiler completely
