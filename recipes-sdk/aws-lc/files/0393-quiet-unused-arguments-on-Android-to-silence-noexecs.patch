From 2bd4bc359124a6ce09e3c96ae97b91a8aa8707be Mon Sep 17 00:00:00 2001
From: Steve Kim <86316075+sbSteveK@users.noreply.github.com>
Date: Tue, 30 May 2023 08:54:56 -0700
Subject: [PATCH] quiet unused arguments on Android to silence --noexecstack
 related warnings (#1028)

Co-authored-by: Justin W Smith <103147162+justsmth@users.noreply.github.com>
---
 crypto/CMakeLists.txt | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/crypto/CMakeLists.txt b/crypto/CMakeLists.txt
index d34602184..1706b8447 100644
--- a/crypto/CMakeLists.txt
+++ b/crypto/CMakeLists.txt
@@ -30,6 +30,12 @@ if(NOT OPENSSL_NO_ASM)
     enable_language(ASM)
     set(CMAKE_ASM_FLAGS "${CMAKE_ASM_FLAGS} -Wa,--noexecstack")
 
+    # Since "--Wa,--noexecstack" is not used during the preprocessor step of Android (because assembler is not invoked),
+    # Clang reports that argument as unused. We quiet the unused argument warning for Android as it's expected behavior.
+    if(ANDROID)
+      set(CMAKE_ASM_FLAGS "${CMAKE_ASM_FLAGS} -Qunused-arguments")
+    endif()
+
     # Clang's integerated assembler does not support debug symbols.
     if (CMAKE_ASM_COMPILER_ID MATCHES "Clang" OR CMAKE_ASM_COMPILER MATCHES "clang")
       message(STATUS "Disabling debug symbols for Clang internal assembler")
